#!/usr/bin/env python3 """ Debug Hugging Face Connection This script helps debug the Hugging Face API connection and token issues. Tests different token formats and provides detailed error information. Author: William Matthew Bryant Created: January 2026 """ import sys import os sys.path.append(os.path.join(os.path.dirname(__file__), '..')) import requests import json def test_token_formats(): """Test different token formats to find the correct one.""" print(" Testing Different Token Formats") print("=" * 35) # Test the user's actual token first user_token = "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" # Different possible token formats based on your input token_variants = [ user_token, # User's actual activated token "hf_CEdr6H7H5tPhPh", # Previous format attempt "CEdr6H.7H5t&Ph&", # Original format you provided "CEdr6H7H5tPhPh", # Without special characters ] base_url = "https://huggingface.co/api" for i, token in enumerate(token_variants): print(f"\n Testing token variant {i+1}: {token[:10]}...") headers = {} if token: headers['Authorization'] = f'Bearer {token}' try: # Test with a simple API call response = requests.get(f"{base_url}/whoami", headers=headers, timeout=10) print(f" Status Code: {response.status_code}") if response.status_code == 200: data = response.json() print(f" SUCCESS! Token works") print(f" User info: {data}") return token elif response.status_code == 401: print(f" Unauthorized - Invalid token") else: print(f" Unexpected response: {response.text[:100]}") except requests.exceptions.RequestException as e: print(f" Network error: {e}") print(f"\n None of the token formats worked") return None def test_public_api_access(): """Test public API access without token.""" print("\n Testing Public API Access (No Token)") print("=" * 40) try: # Test public dataset listing response = requests.get("https://huggingface.co/api/datasets", params={'limit': 5}, timeout=10) print(f"Status Code: {response.status_code}") if response.status_code == 200: data = response.json() print(f" Public API works! Found {len(data)} datasets") # Show first few datasets for i, dataset in enumerate(data[:3]): print(f" {i+1}. {dataset.get('id', 'Unknown')}") return True else: print(f" Public API failed: {response.text[:100]}") return False except Exception as e: print(f" Public API error: {e}") return False def test_specific_datasets(): """Test access to specific conversational datasets.""" print("\n Testing Specific Conversational Datasets") print("=" * 45) datasets_to_test = [ "lmsys/lmsys-chat-1m", "OpenAssistant/oasst2", "microsoft/DialoGPT-medium", "facebook/blended_skill_talk" ] working_token = test_token_formats() headers = {} if working_token: headers['Authorization'] = f'Bearer {working_token}' print(f"Using working token: {working_token[:10]}...") else: print("No working token found, trying without authentication...") working_datasets = [] for dataset_id in datasets_to_test: print(f"\n Testing dataset: {dataset_id}") try: # Test dataset info response = requests.get(f"https://huggingface.co/api/datasets/{dataset_id}", headers=headers, timeout=10) print(f" Status: {response.status_code}") if response.status_code == 200: data = response.json() print(f" Accessible!") print(f" Downloads: {data.get('downloads', 'Unknown')}") print(f" Tags: {data.get('tags', [])[:3]}") working_datasets.append(dataset_id) elif response.status_code == 404: print(f" Dataset not found") elif response.status_code == 401: print(f" Unauthorized - needs token") else: print(f" Status {response.status_code}: {response.text[:50]}") except Exception as e: print(f" Error: {e}") return working_datasets def test_datasets_library(): """Test the datasets library directly.""" print("\n Testing Datasets Library") print("=" * 28) try: from datasets import list_datasets, load_dataset_builder print(" Datasets library available") # Try to list datasets try: print(" Listing available datasets...") datasets = list_datasets() print(f" Found {len(datasets)} total datasets") # Look for conversational ones conversational_datasets = [d for d in datasets if any(keyword in d.lower() for keyword in ['chat', 'dialog', 'conversation', 'oasst'])] print(f" Found {len(conversational_datasets)} conversational datasets:") for dataset in conversational_datasets[:5]: print(f" • {dataset}") except Exception as e: print(f" Could not list datasets: {e}") # Try to load a simple dataset try: print(f"\n Testing dataset loading...") # Try a small, public dataset first builder = load_dataset_builder("squad") print(f" Successfully loaded SQuAD dataset builder") print(f" Description: {builder.info.description[:100]}...") except Exception as e: print(f" Could not load dataset: {e}") except ImportError: print(" Datasets library not available") print(" Install with: pip install datasets") def run_comprehensive_debug(): """Run comprehensive debugging of HF connection.""" print(" Hugging Face Connection Debug") print("=" * 35) # Test 1: Token formats working_token = test_token_formats() # Test 2: Public API public_works = test_public_api_access() # Test 3: Specific datasets working_datasets = test_specific_datasets() # Test 4: Datasets library test_datasets_library() # Summary print(f"\n Debug Summary") print("=" * 15) if working_token: print(f" Working token found: {working_token[:10]}...") else: print(f" No working token found") if public_works: print(f" Public API accessible") else: print(f" Public API issues") if working_datasets: print(f" Accessible datasets: {len(working_datasets)}") for dataset in working_datasets: print(f" • {dataset}") else: print(f" No datasets accessible") # Recommendations print(f"\n Recommendations:") if not working_token and not public_works: print(f" • Check internet connection") print(f" • Verify Hugging Face is accessible from your network") print(f" • Try using a VPN if behind corporate firewall") if not working_token: print(f" • Verify the API token format") print(f" • Check if token has proper permissions") print(f" • Try generating a new token at https://huggingface.co/settings/tokens") if working_datasets: print(f" • Use working datasets for testing: {working_datasets[0] if working_datasets else 'None'}") return { 'working_token': working_token, 'public_api_works': public_works, 'accessible_datasets': working_datasets } if __name__ == "__main__": print(" Hugging Face API Connection Debugger") print("Helps diagnose token and connection issues") print("=" * 50) try: results = run_comprehensive_debug() if results['working_token'] or results['accessible_datasets']: print(f"\n Some functionality working!") print(f" You can proceed with available datasets") else: print(f"\n No functionality working") print(f" Check network connection and token") except Exception as e: print(f"\n Debug failed with error: {e}") import traceback traceback.print_exc()